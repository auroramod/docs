"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[99],{3905:function(e,n,t){t.d(n,{Zo:function(){return p},kt:function(){return m}});var a=t(7294);function o(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function i(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);n&&(a=a.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,a)}return t}function l(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?i(Object(t),!0).forEach((function(n){o(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):i(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function r(e,n){if(null==e)return{};var t,a,o=function(e,n){if(null==e)return{};var t,a,o={},i=Object.keys(e);for(a=0;a<i.length;a++)t=i[a],n.indexOf(t)>=0||(o[t]=e[t]);return o}(e,n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)t=i[a],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(o[t]=e[t])}return o}var c=a.createContext({}),s=function(e){var n=a.useContext(c),t=n;return e&&(t="function"==typeof e?e(n):l(l({},n),e)),t},p=function(e){var n=s(e.components);return a.createElement(c.Provider,{value:n},e.children)},d={inlineCode:"code",wrapper:function(e){var n=e.children;return a.createElement(a.Fragment,{},n)}},u=a.forwardRef((function(e,n){var t=e.components,o=e.mdxType,i=e.originalType,c=e.parentName,p=r(e,["components","mdxType","originalType","parentName"]),u=s(t),m=o,h=u["".concat(c,".").concat(m)]||u[m]||d[m]||i;return t?a.createElement(h,l(l({ref:n},p),{},{components:t})):a.createElement(h,l({ref:n},p))}));function m(e,n){var t=arguments,o=n&&n.mdxType;if("string"==typeof e||o){var i=t.length,l=new Array(i);l[0]=u;var r={};for(var c in n)hasOwnProperty.call(n,c)&&(r[c]=n[c]);r.originalType=e,r.mdxType="string"==typeof e?e:o,l[1]=r;for(var s=2;s<i;s++)l[s]=t[s];return a.createElement.apply(null,l)}return a.createElement.apply(null,t)}u.displayName="MDXCreateElement"},8877:function(e,n,t){t.r(n),t.d(n,{frontMatter:function(){return r},contentTitle:function(){return c},metadata:function(){return s},toc:function(){return p},default:function(){return u}});var a=t(7462),o=t(3366),i=(t(7294),t(3905)),l=["components"],r={},c="Lua Syntax",s={unversionedId:"script-syntax",id:"script-syntax",isDocsHomePage:!1,title:"Lua Syntax",description:"Callbacks",source:"@site/docs/script-syntax.md",sourceDirName:".",slug:"/script-syntax",permalink:"/script-syntax",editUrl:"https://github.com/h1-mod/website/tree/docs/edit/docs/script-syntax.md",tags:[],version:"current",frontMatter:{},sidebar:"mainSidebar",previous:{title:"Loading a Lua script",permalink:"/load-script"},next:{title:"Referencing GSC (+ GSC dump)",permalink:"/gsc-reference"}},p=[{value:"Callbacks",id:"callbacks",children:[],level:2},{value:"Functions defined with &quot;entity:&quot; prefix",id:"functions-defined-with-entity-prefix",children:[],level:2},{value:"Types",id:"types",children:[{value:"Strings",id:"strings",children:[],level:3},{value:"Integer",id:"integer",children:[],level:3},{value:"Float",id:"float",children:[],level:3},{value:"Vector",id:"vector",children:[],level:3},{value:"Entity",id:"entity",children:[],level:3}],level:2},{value:"Events",id:"events",children:[{value:"Event Listening (formerly known as &quot;waittill&quot;)",id:"event-listening-formerly-known-as-waittill",children:[],level:3},{value:"Firing (formerly known as &quot;notify&quot;)",id:"firing-formerly-known-as-notify",children:[],level:3}],level:2},{value:"Timers",id:"timers",children:[],level:2},{value:"Functions",id:"functions",children:[],level:2},{value:"Fields",id:"fields",children:[],level:2},{value:"Command execution",id:"command-execution",children:[],level:2},{value:"Noteworthy information",id:"noteworthy-information",children:[],level:2},{value:"Calling/hooking GSC functions",id:"callinghooking-gsc-functions",children:[],level:2}],d={toc:p};function u(e){var n=e.components,t=(0,o.Z)(e,l);return(0,i.kt)("wrapper",(0,a.Z)({},d,t,{components:n,mdxType:"MDXLayout"}),(0,i.kt)("h1",{id:"lua-syntax"},"Lua Syntax"),(0,i.kt)("h2",{id:"callbacks"},"Callbacks"),(0,i.kt)("p",null,"Before we show any function examples for syntax examples, you must know what a lambda and a callback is. A lambda is a function that's made when passing the argument. When doing a notify, interval, or timeout event (as shown below later), a function callback that's specified is called."),(0,i.kt)("p",null,"You can either make a function callback that uses a lambda:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-lua"},'level:onnotify("connected", function(player)\n    -- [...]\nend)\n')),(0,i.kt)("p",null,"Or, you can make a function callback by calling the function seperate:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-lua"},'function on_player_connected(player)\n    -- [...]\nend\n\nlevel:onnotify("connected", on_player_connected)\n')),(0,i.kt)("p",null,"Syntax examples shown as mostly lambdas, while some are seperate-called functions."),(0,i.kt)("h2",{id:"functions-defined-with-entity-prefix"},'Functions defined with "entity:" prefix'),(0,i.kt)("p",null,"Functions defined with an ",(0,i.kt)("inlineCode",{parentName:"p"},"entity:")," prefix give the function the ability to use the ",(0,i.kt)("inlineCode",{parentName:"p"},"self")," keyword, similar to GSC."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-lua"},'-- entity: prefix defined, makes this function only available to be called on entities\nfunction entity:connected()\n    print("Player " .. self.name .. " connected")\nend\n\nlevel:onnotify("connected", function(player)\n    player:connected()\nend)\n')),(0,i.kt)("p",null,"Syntax examples shown are mostly using entity-defined functions. The alternative to not defining the ",(0,i.kt)("inlineCode",{parentName:"p"},"entity:")," prefix would be passing the player through like normal (as shown in ",(0,i.kt)("a",{parentName:"p",href:"#callbacks"},"callbacks"),")."),(0,i.kt)("h2",{id:"types"},"Types"),(0,i.kt)("p",null,"There are only 5 distinct types needed to interact with game's scripting environment. LUA, of course, has more types, but what is meant by this is the following:"),(0,i.kt)("p",null,"When dealing with events, functions or fields, no complex LUA types are supported, only these primitive types:"),(0,i.kt)("h3",{id:"strings"},"Strings"),(0,i.kt)("p",null,'Strings are text enclosed by quotes as so: "Hello World". There is not much to say about them, as they are a common concept.'),(0,i.kt)("h3",{id:"integer"},"Integer"),(0,i.kt)("p",null,"Integers are all whole numbers like 0, 1000 or -15.\nBoolean values, so true and false, also fall under that category and are handled as 1 and 0 respectively."),(0,i.kt)("h3",{id:"float"},"Float"),(0,i.kt)("p",null,"Floating point values are all numbers like 1.05 or -10.5.\n1.0 is also a floating point number literal. This is due to the dot notation, even though it's technically a whole number."),(0,i.kt)("h3",{id:"vector"},"Vector"),(0,i.kt)("p",null,"A vector is a type that groups exactly 3 floating point components. It is used to represent coordinates, angles or colors in the game."),(0,i.kt)("p",null,"Creating a new vector can be done like this:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-lua"},"local my_vector = vector:new(1.0, 2.0, 3.0)\n\n-- Statements below will be true\nassert(my_vector.x == 1.0)\nassert(my_vector.y == 2.0)\nassert(my_vector.z == 3.0)\n")),(0,i.kt)("p",null,"You can access the individual components using either ",(0,i.kt)("inlineCode",{parentName:"p"},"x"),", ",(0,i.kt)("inlineCode",{parentName:"p"},"y"),", and ",(0,i.kt)("inlineCode",{parentName:"p"},"z")," property accessors, or ",(0,i.kt)("inlineCode",{parentName:"p"},"r"),", ",(0,i.kt)("inlineCode",{parentName:"p"},"g")," and ",(0,i.kt)("inlineCode",{parentName:"p"},"b")," (note that both notations are equivalent, meaning ",(0,i.kt)("inlineCode",{parentName:"p"},"x")," \u2258 ",(0,i.kt)("inlineCode",{parentName:"p"},"r"),", ",(0,i.kt)("inlineCode",{parentName:"p"},"y")," \u2258 ",(0,i.kt)("inlineCode",{parentName:"p"},"g")," and ",(0,i.kt)("inlineCode",{parentName:"p"},"z")," \u2258 ",(0,i.kt)("inlineCode",{parentName:"p"},"b"),")."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-lua"},"local my_vector = vector:new() -- vector is initialized as (0.0, 0.0, 0.0)\nmy_vector.x = 5.0\nmy_vector.y = 1.0\nmy_vector.z = 2.0\n\nlocal val1 = my_vector.x -- val1 is 5.0\nlocal val2 = my_vector.r -- val2 is also 5.0, as x and r are equivalent\n\n-- The statements below are always true\nassert(my_vector.y == my_vector.g)\nassert(my_vector.z == my_vector.b)\n")),(0,i.kt)("h3",{id:"entity"},"Entity"),(0,i.kt)("p",null,"Entities represent 'things' that 'exist' in the game. Players are for example entities.\nVehicles, hud elements, or the level are also entites. They can fire events, but also call functions into the game's scripting environment. Some entites also have certain fields (or properties), like an origin or a name."),(0,i.kt)("h2",{id:"events"},"Events"),(0,i.kt)("p",null,"Entites can fire notify events. The concept was previously known as ",(0,i.kt)("inlineCode",{parentName:"p"},"notify")," and ",(0,i.kt)("inlineCode",{parentName:"p"},"waittill")," in GSC.\nPopular events are the ",(0,i.kt)("inlineCode",{parentName:"p"},"connected")," event fired by the level, or the ",(0,i.kt)("inlineCode",{parentName:"p"},"spawned_player")," event fired by players."),(0,i.kt)("h3",{id:"event-listening-formerly-known-as-waittill"},'Event Listening (formerly known as "waittill")'),(0,i.kt)("p",null,"You can listen to any of these events by calling either ",(0,i.kt)("inlineCode",{parentName:"p"},"onnotify")," or ",(0,i.kt)("inlineCode",{parentName:"p"},"onnotifyonce")," on an entity:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-lua"},'level:onnotify("connected", function(player)\n    -- [...]\nend)\n')),(0,i.kt)("p",null,"In the example above, the ",(0,i.kt)("inlineCode",{parentName:"p"},"player_connected")," callback is called every time a player connects. If you don't want to be notified every time, you can use ",(0,i.kt)("inlineCode",{parentName:"p"},"onnotifyonce")," instead, which only fires once."),(0,i.kt)("p",null,"If you called ",(0,i.kt)("inlineCode",{parentName:"p"},"onnotify")," (or ",(0,i.kt)("inlineCode",{parentName:"p"},"onnotifyonce"),"), but want to stop listening for notifications, you can call clear on the object is returned:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-lua"},'-- [...]\n\nlocal listener = level:onnotify("connected", function(player)\n    -- [...]\nend)\n\n-- [...]\n\nlistener:clear() -- stops listening for the `connected` event\n')),(0,i.kt)("p",null,"Events can carry arguments. For example, the ",(0,i.kt)("inlineCode",{parentName:"p"},"connected")," event by the level carries the connecting ",(0,i.kt)("inlineCode",{parentName:"p"},"player")," as an argument. You can get these arguments by adding paramters to the callback functions, as seen in the player_connected callback above."),(0,i.kt)("h3",{id:"firing-formerly-known-as-notify"},'Firing (formerly known as "notify")'),(0,i.kt)("p",null,"To fire (or notify) a event, you can call the ",(0,i.kt)("inlineCode",{parentName:"p"},"notify")," function on an entity:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-lua"},'-- this callback function is called by the "connected" event\nfunction entity:connected()\n    self:onnotify("hello_world", function()\n        print("Callback was recieved for hello_world notify")\n    end)\n\n    -- [...]\n\n    self:notify("hello_world")\nend\n')),(0,i.kt)("p",null,"Don't forget - you can also pass arguments to the event (there can be any amount, but they must be instances of one of the 5 primitive ",(0,i.kt)("a",{parentName:"p",href:"#types"},"types"),"):"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-lua"},'-- this callback function is called by the "connected" event\nfunction entity:connected()\n    self:onnotify("hello_world", function(str1, str2)\n        print("Callback was recieved for hello_world notify: " .. str1 " " .. str2)\n    end)\n\n    -- [...]\n\n    self:notify("hello_world", "Hello", "World")\nend\n')),(0,i.kt)("h2",{id:"timers"},"Timers"),(0,i.kt)("p",null,"Timers are required to delay the execution. GSC had a function called ",(0,i.kt)("inlineCode",{parentName:"p"},"wait"),", which paused the execution of a thread for a specific amount of time. Due to the control flow being different in LUA, there are neither threads, nor is there a wait function."),(0,i.kt)("p",null,"However, you can do something else to delay the execution. The functions ",(0,i.kt)("inlineCode",{parentName:"p"},"ontimeout")," and ",(0,i.kt)("inlineCode",{parentName:"p"},"oninterval"),", which need to be called on the game object, allow to do that. They take two arguments, a callback and a time to wait in milliseconds."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-lua"},"game:ontimeout(function()\n    -- [...]\nend, 1000)\n")),(0,i.kt)("p",null,"Similar to the functions ",(0,i.kt)("inlineCode",{parentName:"p"},"setTimeout")," and ",(0,i.kt)("inlineCode",{parentName:"p"},"setInterval")," known from JavaScript, ",(0,i.kt)("inlineCode",{parentName:"p"},"ontimeout")," executes the callback exactly once when the delay is reached and ",(0,i.kt)("inlineCode",{parentName:"p"},"oninterval")," executes it every time the specified amount of time passes."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-lua"},"local timer = game:ontimeout(function()\n    -- [...]\nend, 1000)\n\n-- [...]\n\ntimer:clear()\n")),(0,i.kt)("p",null,"Timer callbacks don't and shouldn't take any arguments. If you want to pass an object, like a player, to a callback, you have to capture it, in a lambda for example:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-lua"},'function entity:do_something_cool()\n    print(self.name .. " is now doing something cool.")\n    -- [...]\nend\n\n-- [...]\n\nlocal player = -- [...]\ngame:oninterval(function()\n    player:do_something_cool()\nend, 1000)\n')),(0,i.kt)("h2",{id:"functions"},"Functions"),(0,i.kt)("p",null,"The game provides a set of global functions and entity methods. The functions provided are pretty much the same as COD4 had them, or any other game that uses GSC. Since this game is heavily based off IW6 (Ghosts) engine and is very very similar, most of the GSC used in IW6 and S1 (Advanced Warfare) is the same."),(0,i.kt)("p",null,"You can use a community-made ",(0,i.kt)("a",{parentName:"p",href:"https://znation.nl/cod4script/"},"COD4 Scripting Reference")," website to find some functions (libcod does not exist in stock GSC nor H1-Mod). Any functions, methods, or tokens should be all lowercase."),(0,i.kt)("p",null,"Global functions are functions that don't need an entity to run. They are called on the ",(0,i.kt)("inlineCode",{parentName:"p"},"game")," object (ex: ",(0,i.kt)("inlineCode",{parentName:"p"},"game:isplayer(player)"),"). When referring to the COD4 Scripting Reference, these functions won't have have a ",(0,i.kt)("inlineCode",{parentName:"p"},"Call this on:")," tab."),(0,i.kt)("p",null,"Example of a global function:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-lua"},'local player = -- [...]\nif game:isplayer(player) == 1 then\n    print(player.name .. " is a player")\nend\n')),(0,i.kt)("p",null,"There are also member functions. These will have a ",(0,i.kt)("inlineCode",{parentName:"p"},"Call this on:")," tab on the COD4 Scripting Reference. Example of a member function:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-lua"},"local player = -- [...]\nplayer:freezecontrols(false)\n")),(0,i.kt)("p",null,"For a list of all functions, methods, and tokens available in H1-Mod, have a look at the ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/h1-mod/h1-mod/blob/develop/src/client/game/scripting/function_tables.cpp"},"function, method, and token tables"),"."),(0,i.kt)("h2",{id:"fields"},"Fields"),(0,i.kt)("p",null,"Entities do have fields (or properties). They differ for each type of entity. For example, players have fields like ",(0,i.kt)("inlineCode",{parentName:"p"},"name"),", ",(0,i.kt)("inlineCode",{parentName:"p"},"origin"),", or ",(0,i.kt)("inlineCode",{parentName:"p"},"angles")," and hud elements have fields like ",(0,i.kt)("inlineCode",{parentName:"p"},"x"),", ",(0,i.kt)("inlineCode",{parentName:"p"},"y"),", or ",(0,i.kt)("inlineCode",{parentName:"p"},"alpha"),"."),(0,i.kt)("p",null,"You can get and set them like this (only the 5 primitive types are supported):"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-lua"},"local player_name = player.name\nplayer.origin = vector:new()\n")),(0,i.kt)("p",null,"There is no complete list of which fields exist. For example, ",(0,i.kt)("inlineCode",{parentName:"p"},"level.players")," is not a field and is a variable. Not every field from GSC is available in LUA and may also have a definition of ",(0,i.kt)("inlineCode",{parentName:"p"},"_ID%d")," (",(0,i.kt)("inlineCode",{parentName:"p"},"%d")," = decimal) or ",(0,i.kt)("inlineCode",{parentName:"p"},"_id_%x")," (",(0,i.kt)("inlineCode",{parentName:"p"},"%x")," = hexdecimal), which you can find in the tutorial for finding variable/field IDs later."),(0,i.kt)("h2",{id:"command-execution"},"Command execution"),(0,i.kt)("p",null,"Unlike in GSC, the scripting API allows to execute console commands."),(0,i.kt)("p",null,"You can use the ",(0,i.kt)("inlineCode",{parentName:"p"},"game:executecommand")," function on the game object like this:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-lua"},'game:executecommand("map mp_crash")\n')),(0,i.kt)("h2",{id:"noteworthy-information"},"Noteworthy information"),(0,i.kt)("p",null,"Players can disconnect. It might sound obvious, but is important for scripting. Executing functions on a player that doesn't exist won't work. Additionally, captured player objects need to be freed."),(0,i.kt)("p",null,"GSC used to have a function called ",(0,i.kt)("inlineCode",{parentName:"p"},"endon"),", which allowed to terminate a thread as soon as an event happend. For example, ",(0,i.kt)("inlineCode",{parentName:"p"},'player endon("disconnect")')," stopped the execution of a thread when a player disconnected."),(0,i.kt)("p",null,"Back when IW6x had just released Lua scripting, the ",(0,i.kt)("inlineCode",{parentName:"p"},"endon")," functionality did not exist. Later in IW6x, S1x, and now H1-Mod, the ",(0,i.kt)("inlineCode",{parentName:"p"},"endon")," functionality has been implemented like so:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-lua"},'function entity:do_something_cool()\n    print(self.name .. " is now doing something cool.")\n    -- [...]\nend\n\n-- [...]\n\nlocal player = -- [...]\nlocal timer = game:oninterval(function()\n    player:do_something_cool()\nend, 1000)\n\n-- the interval timer loop will stop running when the `disconnect` event is called on the player\ntimer:endon(player, "disconnect")\n')),(0,i.kt)("h2",{id:"callinghooking-gsc-functions"},"Calling/hooking GSC functions"),(0,i.kt)("p",null,"Refer to ",(0,i.kt)("a",{parentName:"p",href:"/gsc-reference"},"GSC Reference")," to figure out how to do this."))}u.isMDXComponent=!0}}]);